<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fagblikk 2025</title>
  <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f4f1e5;
      --ink:#2e1d0e;
      --card:#fff4d1;
      --line:#7b5e3d;
      --card-hover:#f9e8b2;
    }
    *{box-sizing:border-box}
    body {
      margin: 0;
      font-family: 'MedievalSharp', cursive;
      background-color: var(--bg);
      color: var(--ink);
    }
    header {
      text-align: center;
      padding: 18px 12px;
      font-size: 2rem;
      background: var(--card);
      border-bottom: 2px solid var(--line);
    }
    #countdown {
      text-align: center;
      font-size: 1.1rem;
      margin: 8px 0 16px;
    }
    /* tile grid */
    #mainMenu{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      padding: 6px 6px 40px;
      gap:12px;
    }
    .tile {
      flex: 1 1 calc(48% - 12px);
      min-width: 280px;
      max-width: 680px;
      padding: 18px;
      background-color: var(--card);
      border: 2px solid var(--line);
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
      transition: transform .08s ease, background-color .08s ease;
      user-select: none;
    }
    .tile:active { transform: translateY(1px) }
    .tile:hover { background-color: var(--card-hover); }
    .tile img { display:block; margin:0 auto 8px; height:46px; width:auto }
    .hidden { display:none; }

    /* content pages */
    .page {
      padding: 16px;
      max-width: 820px;
      margin: 0 auto 40px;
    }
    .page h2{ margin-top:0 }
    .btn {
      padding: 10px 18px;
      margin: 10px 6px 0 0;
      font-family: inherit;
      font-size: 1rem;
      background-color: var(--card);
      border: 2px solid var(--line);
      cursor: pointer;
      border-radius: 8px;
    }
    .btn:hover { background-color: var(--card-hover); }
    .quest-list { list-style:none; padding:0; }
    .quest-list li { margin: 10px 0; }
    .checklist { list-style:none; padding:0; }
    .checklist li{ margin:8px 0 }
    .backbar{ padding:8px 16px }
    .gallery img{ max-width:100%; height:auto; display:block; margin:0 auto 16px }
  </style>
</head>
<body>
  <header>Fagblikk 2025</header>
  <div id="countdown">Nedtelling...</div>

  <!-- MAIN MENU -->
  <div id="mainMenu">
    <div class="tile" onclick="openFagcraftMenu()">World of Fagcraft</div>
    <div class="tile" onclick="openDailyQuests()">Daily Quests</div>
    <div class="tile" onclick="showPage('mykle')">Mykle</div>
    <div class="tile" onclick="showPage('flyreiser')">Flyreiser</div>
    <div class="tile" onclick="showPage('overnatting')">Overnatting</div>
    <div class="tile" onclick="showPage('ol')">Belgiske øl</div>
    <div class="tile" onclick="showKontingent('gir')">Kontingentet gir</div>
    <div class="tile" onclick="showKontingent('tar')">Kontingentet tar</div>
    <div class="tile" onclick="incrementCounter()">
      <img src="eirik.png" alt="Eirik Enge" />
      <div>Eirik Enge-counter: <span id="engeCount">0</span></div>
    </div>
  </div>

  <!-- RPG -->
  <div id="rpgContainer" class="hidden page"></div>

  <!-- DAILY QUESTS -->
  <div id="dailyContainer" class="hidden page">
    <h2>Dag 1: Daily Quests</h2>
    <ul class="quest-list" id="dqList">
      <li><label><input type="checkbox" data-key="dq1"> Pils før flyplassen</label></li>
      <li><label><input type="checkbox" data-key="dq2"> Pils hos Au Pairen</label></li>
      <li><label><input type="checkbox" data-key="dq3"> Pils på første fly</label></li>
      <li><label><input type="checkbox" data-key="dq4"> Pils på flyplassen</label></li>
      <li><label><input type="checkbox" data-key="dq5"> Pils på andre fly</label></li>
      <li><label><input type="checkbox" data-key="dq6"> Prøve en ny øl du aldri har smakt</label></li>
      <li><label><input type="checkbox" data-key="dq7"> Spise noe fritert</label></li>
      <li><label><input type="checkbox" data-key="dq8"> Loote en gjenstand</label></li>
      <li><label><input type="checkbox" data-key="dq9"> Hemse</label></li>
    </ul>
    <div class="backbar">
      <button class="btn" onclick="showMainMenu()">Tilbake</button>
    </div>
    <hr/>
    <h3>Dag 2–4</h3>
    <p>Daily quests for disse dagene vil komme senere.</p>
  </div>

  <!-- GENERIC PAGE CONTAINER -->
  <div id="pageContent" class="hidden page"></div>

  <!-- KONTINGENT -->
  <div id="kontingentContainer" class="hidden page"></div>

  <script src="rpg.js">
    // Extra safety: event delegation for any tiles inside #pageContent
    document.addEventListener('DOMContentLoaded', () => {
      const page = document.getElementById('pageContent');
      if (!page) return;
      page.addEventListener('click', (e) => {
        const t = e.target.closest('.tile');
        if (!t || !page.contains(t)) return;
        const oc = t.getAttribute('onclick') || '';
        const m = oc.match(/startRPG\((\d+)\)/);
        if (m && typeof window.startRPG === 'function') {
          e.preventDefault();
          window.startRPG(parseInt(m[1], 10));
        }
      });
    });

  </script>
  <script>

    // ---- Safer click handling for chapter tiles (mobile friendly) ----
    function hydrateChapterTiles(scope) {
      try {
        const root = scope || document;
        const tiles = root.querySelectorAll('.tile[onclick^="startRPG("]');
        tiles.forEach(el => {
          if (el.dataset.hydrated === '1') return;
          const onclick = el.getAttribute('onclick') || '';
          const match = onclick.match(/startRPG\((\d+)\)/);
          if (match) {
            const n = parseInt(match[1], 10);
            el.addEventListener('click', () => { if (typeof startRPG === 'function') startRPG(n); });
            el.setAttribute('role', 'button');
            el.setAttribute('tabindex', '0');
            el.addEventListener('keydown', (e) => {
              if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); if (typeof startRPG === 'function') startRPG(n); }
            });
            el.dataset.hydrated = '1';
          }
        });
      } catch (e) { /* no-op */ }
    }

    // Observe #pageContent for dynamic menus coming from rpg.js returnToChapters()
    document.addEventListener('DOMContentLoaded', () => {
      const page = document.getElementById('pageContent');
      if (page) {
        const obs = new MutationObserver(() => hydrateChapterTiles(page));
        obs.observe(page, { childList: true, subtree: true });
      }
      // Initial hydration in case menu is already present
      hydrateChapterTiles(document);
    });
    // -------- Persistent Eirik Enge Counter --------
    let engeCounter = parseInt(localStorage.getItem('engeCount') || '0', 10);
    document.addEventListener('DOMContentLoaded', () => {
      const span = document.getElementById('engeCount');
      if (span) span.innerText = engeCounter;
      // Restore Daily Quest checks
      document.querySelectorAll('#dqList input[type=checkbox]').forEach(cb => {
        const key = cb.getAttribute('data-key');
        cb.checked = localStorage.getItem(key) === '1';
        cb.addEventListener('change', () => {
          localStorage.setItem(key, cb.checked ? '1' : '0');
        });
      });
      updateCountdown();
      setInterval(updateCountdown, 1000);
    });

    function incrementCounter() {
      engeCounter++;
      localStorage.setItem('engeCount', String(engeCounter));
      const span = document.getElementById('engeCount');
      if (span) span.innerText = engeCounter;
    }

    // -------- Countdown --------
    function updateCountdown() {
      const target = new Date("2025-10-09T07:00:00").getTime();
      const now = Date.now();
      const diff = target - now;
      const el = document.getElementById("countdown");
      if (!el) return;
      if (diff <= 0) { el.textContent = "Turen har startet!"; return; }
      const d = Math.floor(diff / 86400000);
      const h = Math.floor((diff % 86400000) / 3600000);
      const m = Math.floor((diff % 3600000) / 60000);
      const s = Math.floor((diff % 60000) / 1000);
      el.textContent = `Nedtelling: ${d}d ${h}t ${m}m ${s}s`;
    }

    // -------- Navigation helpers --------
    function showMainMenu() {
      document.getElementById('mainMenu').classList.remove('hidden');
      document.getElementById('dailyContainer').classList.add('hidden');
      document.getElementById('pageContent').classList.add('hidden');
      document.getElementById('rpgContainer').classList.add('hidden');
      document.getElementById('kontingentContainer').classList.add('hidden');
      window.scrollTo({top:0, behavior:'smooth'});
    }

    function openDailyQuests() {
      document.getElementById('mainMenu').classList.add('hidden');
      document.getElementById('dailyContainer').classList.remove('hidden');
      document.getElementById('pageContent').classList.add('hidden');
      document.getElementById('rpgContainer').classList.add('hidden');
      document.getElementById('kontingentContainer').classList.add('hidden');
      window.scrollTo({top:0, behavior:'smooth'});
    }

    function openFagcraftMenu() {
      const content = document.getElementById('pageContent');
      content.innerHTML = `
        <h2>World of Fagcraft</h2>
        <div class="tile" onclick="startRPG(1)">Kapittel 1: Myklus Oppvåkning</div>
        <div class="tile" onclick="startRPG(2)">Kapittel 2: Flugten fra Vegard Beid</div>
        <div class="tile" onclick="startRPG(3)">Kapittel 3: Rulles Prøvelse</div>
        <div class="tile" onclick="startRPG(4)">Kapittel 4: Bams Hrur</div>
        <div class="tile" onclick="startRPG(5)">Kapittel 5: Skumløs-skogen & KFC</div>
        <div class="backbar"><button class="btn" onclick="showMainMenu()">Tilbake</button></div>
      `;
      content.classList.remove('hidden');
      hydrateChapterTiles(content);
      document.getElementById('mainMenu').classList.add('hidden');
      document.getElementById('dailyContainer').classList.add('hidden');
      document.getElementById('rpgContainer').classList.add('hidden');
      document.getElementById('kontingentContainer').classList.add('hidden');
      window.scrollTo({top:0, behavior:'smooth'});
    }

    // -------- Content pages --------
    function showPage(page) {
      const wrap = document.getElementById('pageContent');
      wrap.classList.remove('hidden');
      document.getElementById('mainMenu').classList.add('hidden');
      document.getElementById('dailyContainer').classList.add('hidden');
      document.getElementById('rpgContainer').classList.add('hidden');
      document.getElementById('kontingentContainer').classList.add('hidden');

      if (page === 'mykle') {
        wrap.innerHTML = `
          <h2>Mykle</h2>
          <p>Mykle er en maskin på alle felt: faglig sterk, sosialt robust og med en legendarisk seighet når det virkelig gjelder. Han drikker ekstreme mengder pils, men holder linja skarpt—både i teori og praksis.</p>
          <p>På tur er Mykle både kompass og katalysator: han finner veien, setter tempoet og sørger for at stemningen aldri dør. Når andre famler, leverer Mykle. Fasit.</p>
          <p>Hyllest: måtte glassholdet være stødig, bøtteholdet bunnsolid og skumkronen alltid verdig Mykle.</p>
          <div class="backbar"><button class="btn" onclick="showMainMenu()">Tilbake</button></div>
        `;
      } else if (page === 'flyreiser') {
        wrap.innerHTML = `
          <h2>Potensielle flyvninger</h2>
          <p>Molde → Brussel (og retur). Her kan dere legge inn alternativer/detaljer etter hvert.</p>
          <ul>
            <li>Dag 1 tidlig – via OSL (TBD)</li>
            <li>Dag 1 senere – via AMS/FRA (TBD)</li>
            <li>Dag 2 alternativer – (TBD)</li>
          </ul>
          <div class="backbar"><button class="btn" onclick="showMainMenu()">Tilbake</button></div>
        `;
      } else if (page === 'overnatting') {
        wrap.innerHTML = `
          <h2>Overnatting</h2>
          <p><em>TBD</em> – Booking-detaljer legges inn når klart.</p>
          <div class="backbar"><button class="btn" onclick="showMainMenu()">Tilbake</button></div>
        `;
      } else if (page === 'ol') {
        // Belgiske øl – sjekkliste (lagres lokalt per bruker)
        const beers = [
          "Westmalle Tripel","Westmalle Dubbel","Rochefort 10","Rochefort 8","Chimay Blå",
          "Chimay Rød","Chimay Hvit","Orval","Duvel","La Chouffe","Tripel Karmeliet",
          "St. Bernardus Abt 12","St. Bernardus Tripel","Gulden Draak","Kwak","Delirium Tremens",
          "Delirium Nocturnum","Straffe Hendrik Tripel","Poperings Hommelbier","Gouden Carolus Classic",
          "Gouden Carolus Tripel","Leffe Tripel","Leffe Brune","Jupiler","Hoegaarden",
          "Maredsous 10","Achel Blond","Achel Bruin","Westvleteren 12 (drøm)","Kasteel Donker"
        ];
        let html = `<h2>Belgiske øl – sjekkliste</h2><ul class="checklist">`;
        beers.forEach((b,i)=>{
          const key = "beer_"+i;
          const checked = localStorage.getItem(key) === '1' ? 'checked' : '';
          html += `<li><label><input type="checkbox" data-beer="${key}" ${checked}> ${b}</label></li>`;
        });
        html += `</ul><div class="backbar"><button class="btn" onclick="showMainMenu()">Tilbake</button></div>`;
        wrap.innerHTML = html;
        wrap.querySelectorAll('input[type=checkbox][data-beer]').forEach(cb=>{
          cb.addEventListener('change', () => {
            localStorage.setItem(cb.getAttribute('data-beer'), cb.checked ? '1' : '0');
          });
        });
      }
    }

    // -------- Kontingent pages --------
    function showKontingent(type){
      const cont = document.getElementById('kontingentContainer');
      cont.classList.remove('hidden');
      document.getElementById('mainMenu').classList.add('hidden');
      document.getElementById('dailyContainer').classList.add('hidden');
      document.getElementById('pageContent').classList.add('hidden');
      document.getElementById('rpgContainer').classList.add('hidden');

      if(type === 'gir'){
        cont.innerHTML = `
          <h2>Kontingentet gir</h2>
          <div class="gallery">
            <img src="1.jpg" alt="Bilde 1"/>
            <img src="2.jpg" alt="Bilde 2"/>
            <img src="3.jpg" alt="Bilde 3"/>
            <img src="4.jpg" alt="Bilde 4"/>
            <img src="5.jpg" alt="Bilde 5"/>
          </div>
          <div class="backbar"><button class="btn" onclick="showMainMenu()">Tilbake</button></div>
        `;
      }else{
        cont.innerHTML = `
          <h2>Kontingentet tar</h2>
          <div class="gallery">
            <img src="do.jpg" alt="Kontingentet tar"/>
          </div>
          <div class="backbar"><button class="btn" onclick="showMainMenu()">Tilbake</button></div>
        `;
      }
      window.scrollTo({top:0, behavior:'smooth'});
    }
  </script>
</body>
</html>
